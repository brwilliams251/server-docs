= インストールガイド
:description: 1台のマシンおよび複数のマシンシステムへのインストール


このガイドでは、TigerGraphプラットフォームをシングルノードまたはマルチノードクラスターとして、インタラクティブまたは非インタラクティブでインストールする方法について説明しています。

NOTE: エンタープライズフリーライセンスでサインアップした場合は、Dockerイメージまたは仮想マシン(VirtualBox)イメージとしてTigerGraphプラットフォームにアクセスすることもできます。
xref:cloud:start:overview.adoc[はじめに]の指示に従って、DockerコンテナーまたはVirtualBoxでTigerGraphを起動してください。

手引き動画:

video::sfe3Q37oWJQ[youtube,800,600]


== 準備

TigerGraphシステムをインストールする前に、以下の準備をしてください。

* xref:hw-and-sw-requirements.adoc[__ハードウェアおよびソフトウェア最小要件__]を満たす1台以上のマシン。
* すべてのマシンで同じユーザー名とログイン資格を持つsudoユーザー。
** sudo権限が利用できない場合、代替策についてはTigerGraphサポートにご連絡ください。
* TigerGraphが提供するライセンスキー(エンタープライズフリー以外の場合)
* TigerGraphシステムパッケージ
** TigerGraphシステムパッケージをまだお持ちでない場合は、次のアドレスより要求できます https://www.tigergraph.co.jp/get-tigergraph/
* クラスターをインストールする場合は、すべてのマシンに同じSSHポートがあることを確認し、インストール中はポートが開いたままであるようにしてください

== **インストール**

TigerGraphのインストールスクリプトは、シングルノードとクラスターの両方のインストールをサポートしています。インストールの際は、インタラクティブまたは非インタラクティブのいずれかを選択することができます。

=== インタラクティブでのインストール

以下に、LinuxにTigerGraphをインタラクティブでインストールする手順を説明します。パッケージのファイル名は、製品のエディションとバージョンによって異なります。この例では、ファイル名 `tigergraph-<version>.tar.gz` を使用します。これをお使いのパッケージの実際のファイル名に置き換えてください。

==== **ステップ 1** :パッケージの抽出

次のコマンドを実行して、パッケージを抽出してください。
`tigergraph-<version>-offline` という名前のフォルダーが作成されます。

[,console]
----
$ tar -xzf tigergraph-<version>.tar.gz
----


[#_step_2_run_installation_script]
==== **ステップ 2**: インストールスクリプトの実行

`tigergraph-<version>-offline` フォルダーに移動し、次のコマンドを使用してスクリプト `install.sh` を実行します。

.インストールスクリプトの実行
[source,console]
----
$ cd tigergraph-<version>-offline

# エンタープライズライセンスのインストール
$ sudo ./install.sh

# 非インタラクティブのインストールを行うには、非インタラクティブモードのセクションを参照して下さい。
----


インストーラーから次の情報の入力を要求されます。これらの情報については、Enterキーを押してスキップすること、システムのデフォルトを使用すること、新しい値を入力することを選択できます。

* ライセンス契約条件への同意
* ライセンスキー(エンタープライズフリー以外の場合)
* TigerGraphプラットフォームを所有・管理するLinuxユーザーのユーザー名
** インストーラーはLinuxユーザーを作成します。このユーザーは `gadmin` コマンドを実行してTigerGraphプラットフォームを管理できる唯一の認証されたユーザーであり、このユーザー名の対象者となります
* TigerGraphプラットフォームを所有・管理するLinuxユーザーのパスワード
* インストールフォルダーの保存先パス
* データフォルダーの保存先パス
* ログフォルダーの保存先パス
* 一時フォルダーの保存先パス
* 使用マシンのSSHポート

デフォルトの設定を見るには、以下の<<#_installation_options,インストールのオプション_>>セクションをご覧ください。

WARNING: ライセンスキーは100文字を超える長さです。ライセンスキーをコピーして貼り付ける場合は、誤って行末文字を含めないように注意してください。


==== **ステップ 3**: クラスター設定

TigerGraphのクラスター設定では、グラフデータベースを分割し、ローカルネットワーク内の複数のサーバーノードに分散させることができます。上記のステップで説明した質問に答えた後、インストールスクリプトによる、クラスター設定を完了するための以下の情報を入力する必要があります。

* クラスター内のノード数。各ノードには、入力に続いて別名が与えられます(`m1` 、 `m2` 、 `m3` など)
** シングルノードのインストールの場合、`1` を入力します
* 各ノードのIPアドレス
* sudoユーザーのユーザー名とログイン資格情報
** クラスター内のすべてのマシンで、同じユーザー名とパスワードまたはSSHキーを持つsudoユーザーが必要です。
* NTP時刻同期を設定する権限
* クラスターノード間でファイアウォールのルールを設定する権限


NOTE: TigerGraph 3.xでは、インストールマシンはクラスターの中または外部に配置できます。クラスター外の場合でも、インストールマシンはLinuxマシンである必要があります。


すべての質問に回答すると、スクリプトはインストールを始めます。インタラクティブインストールのスクリーンショットを以下に示します。

image::image (76).png[]

==== **ステップ 4**: インストールの確認

インストールが完了したら、次のコマンドを使用して、プラットフォームを所有するLinuxユーザー(xref:install.adoc#_step_2_run_installation_script[ステップ 2]で作成)に切り替えることができます。

[,console]
----
$ su <username>  # デフォルトのユーザー名はtigergraph
----

プロンプトで、ステップ 2で設定したパスワードを入力します。

正しいユーザーに切り替えると、xref:system-management:management-commands.adoc[`gadmin` コマンド]を使用できるようになります。`gadmin status` を実行して、インストールが成功したことを確認してください。システムが正しくインストールされ、ライセンスが有効化されている場合、コマンドはすべてのサービスが起動して準備が整っていると回答します。グラフデータがまだロードされていないため、GSEとGPEについては `"Warmup"` と表示されます。

image::image (77).png[Status of all components upon successful installation]

=== 非インタラクティブのインストール

以下に、LinuxにTigerGraphを非インタラクティブでインストールする手順を説明します。

==== **ステップ 1**: パッケージの抽出

次のコマンドを実行して、パッケージを抽出してください。`tigergraph-<version>-offline` という名前のフォルダーが作成されます。


.Extract for version X.Y.Z
[,console]
----
$ tar -xzf tigergraph-<version>.tar.gz
----


==== *ステップ 2*: インストールスクリプトの設定

`tigergraph-<version>-offline` フォルダーに移動します。フォルダー内に `install_conf.json` という名前のファイルがあります。非インタラクティブモードでのインストールの場合、インストーラーを実行する前に、 `install_conf.json` ファイル内のすべての設定を確認または変更する必要があります。

以下は `install_conf.json` ファイルの例です。

[,javascript]
----
{
  "BasicConfig": {
    "TigerGraph": {
      "Username": "tigergraph",
      "Password": "tigergraph",
      "SSHPort": 22,
      "PrivateKeyFile": "",
      "PublicKeyFile": ""
    },
    "RootDir": {
      "AppRoot": "/home/tigergraph/tigergraph/app",
      "DataRoot": "/home/tigergraph/tigergraph/data",
      "LogRoot": "/home/tigergraph/tigergraph/log",
      "TempRoot": "/home/tigergraph/tigergraph/tmp"
    },
    "License": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJJc3N1ZXIiOiJUaWdlckdyYXBoIEluYy4iLCJBdWRpZW5jZSI6IlRpZ2VyR3JhcGggRnJlZSIsIlN0YXJ0VGltZSI6MTYxNzM1NTgwMywiRW5kVGltZSI6MTY1MTQ4NzQwMywiSXNzdWVUaW1lIjoxNjE3MzU5NDAzLCJFZGl0aW9uIjoiRW50ZXJwcmlzZSIsIlZlcnNpb24iOiJBbGwiLCJIb3N0Ijp7Ik1heENQVUNvcmUiOjEwMDAwMDAwMDAwMDAwMDAsIk1heFBoeXNpY2FsTWVtb3J5Qnl0ZXMiOjEwMDAwMDAwMDAwMDAwMDAsIk1heENsdXN0ZXJOb2RlTnVtYmVyIjoxMDI0fSwiVG9wb2xvZ3kiOnsiTWF4VmVydGV4TnVtYmVyIjoxMDAwMDAwMDAwMDAwMDAwLCJNYXhFZGdlTnVtYmVyIjoxMDAwMDAwMDAwMDAwMDAwLCJNYXhHcmFwaE51bWJlciI6MTAyNCwiTWF4VG9wb2xvZ3lCeXRlcyI6NTM2ODcwNjM3MTJ9LCJHU1QiOnsiRW5hYmxlIjp0cnVlLCJab29tQ2hhcnRzTGljZW5zZSI6IntcbiAgXCJsaWNlbnNlXCI6IFwiWkNCLTRtZmk3NDRsdjogWm9vbUNoYXJ0cyBFbnRlcnByaXNlIGxpY2VuY2UgZm9yIFRpZ2VyR3JhcGggZm9yIG9mZmxpbmUgdXNlOyB1cGdyYWRlcyB1bnRpbDogMjAyMi0xMi0zMVwiLFxuICBcImxpY2Vuc2VLZXlcIjogXCI4Zjg2ZWQzM2Y0ZWJmYmE4YTI4NjlkZGUzMmYzYTMwZGI4NGEzOTgxYmEzNmZhZWZlYTMxNDhhYzY4MzkxZTlhYzUzZDU3YmI5MjdmNjY5YWI1ZWJhYzJhYmQ3YTFkNDBiM2UxNDRmZjIwMDYyZWNiZmIwZjJiN2I0ZWFmZWIwYzU2NTc2NjBhZGExZDc1MWNhODU3NWZhYTE1ZWQwODI0NzkwZWQxMjJkY2Q4NjcyZTJiN2QzN2MwNmE3MzFhYTc2MDIwM2FhYmMwYjYzOWEzMjBhOGQxNmI0YmFiNGY5NTJiNTMwOTUzMWI4MDkxNjYwZDVjOGMzNGY0NmMyNjZiOGZiNzc2YzFmN2Y0MTdlMGQ5Y2JkZGFlOTExNTFlY2Y3YmMzZDlkNDgyNWE2MjAwYzk0MWMyMDE4ZDY4YjkyOWE5ZWY2MzQ2MDE5NjFhYmU1MGI0ZTk0ZmY5Y2VjMjA1ODEwYmVlZmRkM2NlZDU2YjM5NTVjYmE0YWIyMGNiNzc5MWE0NmQxNzIwMzNiZmI0ZDIyMDM4ODZhZTllZDFkOWMzOWIyOTM2ODc3Yjc2NzY4ZjQwNWQ5Y2MwY2JlODVjOTE2NDllMDI5YTA0NDFlOGFmYjA2MzY4MTMxZGM1YTc1NDEyOTc1NjFlMDRlMGM1MzE1ZmFjMDdhYzViOWViM1wiXG59In0sIlJ1bnRpbWVNZW1vcnkiOnsiTWF4VXNlclJlc2lkZW50U2V0Qnl0ZXMiOjEwMDAwMDAwMDAwMDAwMDB9fQ.B1tR-ZyzFB3WCtCXBl-CXb-3YlL1Hy1btCzsEnkLd6GE2AOvJdpqVZGU-YGyIaOGSYX1sbjrePBoupuWPwrOgvce-mq_Qwp8eounoEOkuzYlTQXFj3lM1wO6vrdiOn2GUm0qMVtlVTIDrFZlZ-bWcdSUA4J8t2JNJrYxQgPWjlO9f4I4w2RbTK3sZW7N96bqFUQPituiwLcPX_VSVT8KBluM2WIH7CJitHl21IbnQbwScBw_QgjfaITZXE6UXisMM9XNphf5yQX9arFDQLchV7e2i3R2tUEuF7V_mHFrVa8vCBjm_0uABzcY8U02QJ78SB9MgLNrqgtzIwHmYP22KQ",
    "NodeList": [
      "m1: 127.0.0.1"
    ]
  },
  "AdvancedConfig": {
    "ClusterConfig": {
      "LoginConfig": {
        "SudoUser": "sudoUserName",
        "Method": "P[or K]",
        "P": "<sudo_user_password>",
        "K": "</path/to/my_key.pem_rsa>"
      },
      "ReplicationFactor": 1
    }
  }
}
----

以下は設定ファイルのフィールドの説明です。

* `"BasicConfig"`
** `"TigerGraph"` : TigerGraphプラットフォームを管理するためにインストーラーによって作成される、LinuxユーザーであるTigerGraph Linuxユーザーに関する情報。 `gadmin` などのコマンドは、TigerGraph Linuxユーザーのみが使用できます。
*** `"Username"`: Linuxユーザーのユーザー名。
*** `"Password"`:Linuxユーザーのパスワード。
*** `"SSHPort"`: SSH接続確立のために使用されるポート番号。
*** `"PrivateKeyFile"` (オプション): 有効な秘密鍵ファイルへの絶対パス。空のままにすると、 `tigergraph.rsa` という名前のパスを自動的に生成します。
*** `"PublicKeyFile"`(オプション): 有効な公開鍵ファイルへの絶対パス。空のままにすると、 `tigergraph.pub` という名前のパスを自動的に生成します。
** `"RootDir"`
*** `"AppRoot"`: アプリケーションフォルダーの保存先の絶対パス。
*** ``"DataRoot``": データフォルダーの保存先の絶対パス。
*** `"LogRoot"`: ログフォルダーの保存先の絶対パス。
*** `"TempRoot"`: 一時フォルダーの保存先の絶対パス。
** `"License"`: お使いのTigerGraphのライセンス文字列。
** `"Node List"`: クラスター内のノードのJSON配列。クラスター内の各マシンは、キーと値のペアとして定義されます。キーはマシンの別名(m1、m2、m3など)であり、値はノードのIPアドレスです。
* `"AdvancedConfig"`
** `"ClusterConfig"`: クラスター設定
*** `"LoginConfig"`: ログイン設定
**** `"SudoUser"`: すべてのノードでインストールを行うために使用されるsudoユーザーのユーザー名
**** `"Method"`: SSHの認証方法。パスワード認証を使用するには `"P"` を、キーベースの認証を使用するには `"K"` を入力します。
**** `"P"`: sudoユーザーのパスワード。
**** `"K"`: sudoユーザーの認証に使用されるSSHキーへの絶対パス。
*** `"ReplicationFactor"`: クラスターのxref:ha:ha-cluster.adoc[レプリケーション係数]
**** xref:ha:ha-cluster.adoc[高可用性(HA)機能]を有効にする場合は、クラスター内に少なくとも3つのノードがあることを確認し、レプリケーション係数を1より大きい値に設定してください。たとえばクラスターが6ノードなら、レプリケーション係数に2か3を設定することができます。レプリケーション係数を2に設定すると、分割係数は 6 / 2 = 3で、3になります。したがって、3つのノードが1つのデータのコピーに、他の3つのノードはデータのレプリカコピーとして使用されます。
**** レプリケーション係数には、ノード総数を完全に割り切れる数を設定してください。そうでない場合、一部のノードがHAクラスターの一部として使用されない場合があります。

==== ステップ 3: インストールスクリプトを `-n` オプションで実行

`-n` オプションを指定して `install.sh` スクリプトを実行し、非インタラクティブのインストールプロセスを開始します。

[,bash]
----
$ sudo ./install.sh -n
----

[#_installation_options]
=== インストールのオプション

パラメーターが指定されなかった場合、次のデフォルト設定が適用されます。

* インストーラーは、ユーザー名  `tigergraph` 、パスワード `tigergraph` のLinuxユーザーを作成します。このユーザーは、TigerGraphプラットフォームおよびサービスを管理するための `gadmin` コマンド実行を許可される唯一のユーザーになります。
** `tigergraph` という名前のユーザーがすでに存在する場合、このユーザーはプラットフォームの所有者として指定されます。他のユーザーは作成されません。
* インストールのデフォルトのルートディレクトリーは `/home/tigergraph/tigergraph` で、その中にApp/Data/Log/Tempファイルがあります。
** アプリケーションパス : `/home/tigergraph/tigergraph/app`
** データパス: `/home/tigergraph/tigergraph/data`
** ログパス: `/home/tigergraph/tigergraph/log`
** 一時パス: `/home/tigergraph/tigergraph/tmp`
* インストールのルートディレクトリー(`<tigerGraph_root_dir>` で参照されます)は、tigergraphユーザーのホームディレクトリー、つまり `/home/tigergraph/tigergraph` にある `tigergraph` というフォルダーです。

インストールは、 `install.sh` スクリプトを使用してコマンドラインオプションを実行することで、カスタマイズ可能です。

==== コマンドラインオプション

[,bash]
----
# install.shのコマンドラインオプション
Usage:
./install.sh [-n] [-u <user>] [-p <password>] [-r <tigergraph_root_dir>] [-l <license_key>] [-F] [-N]
./install.sh -h
オプション:
  -h  --  ヘルプ情報を表示
  -u  --  作成するLinuxユーザーのユーザー名[デフォルト: tigergraph]
  -p  --  作成するLinuxユーザーのパスワード[デフォルト: tigergraph]
  -l  --  TigerGraphライセンスキー
  -n  --  非インタラクティブのオプション: プロンプトを表示せず、
          デフォルトの設定を使用してインストールします
  -F  --  クラスターノード間でTCPポートを開くようにiptables(ファイアウォール)ルールを設定します
  -N  --  クラスターノード間のNTPシステム時刻同期を設定します

[NOTE    ]: オプション '-n' を使用すると、設定ファイル"install_config.json"内の
            すべての設定で、単一ノードまたはクラスターにプラットフォームが
            非インタラクティブにインストールされます。
            この場合、インストール前に設定ファイルの変更を行う必要があります。

[WARNING ]: オプション '-n' と同時に '-F' 、'-N' 以外のオプションが指定されている場合、
            インストールは失敗します。
----
