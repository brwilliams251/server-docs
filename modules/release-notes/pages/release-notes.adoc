= リリースノート
:description: リリースノート - TigerGraph 3.4.
:page-aliases: change-log.adoc

2021年12月21日にTigerGraph Server 3.4.0がリリースされました。

== Log4j CVE-2021-45105のセキュリティパッチ
TigerGraph 3.4.0には、Log4j CVE-2021-45105のセキュリティパッチが含まれています。
詳しくは <<改善された問題>> をご覧ください。

== 新機能 - TigerGraph GraphQL サービス
TigerGraphサーバ3.4.0に伴い、xref:graphql::intro.adoc[TigerGraph GraphQL Service]を導入しました。

TigerGraph GraphQL Serviceは、TigerGraphのグラフデータにアクセスするためのGraphQLリクエストを行うことができるようになります。
詳しくは、 xref:graphql::intro.adoc[TigerGraph GraphQL Service]をご覧ください。

== 新機能

以下は、TigerGraph 3.4.0の新機能と改善点のリストです。

=== 管理性
* 現在のクラスタリーダーを表示するために `gsql` に　xref:ha:cluster-commands.adoc#_show_current_gsql_leader[`-leader` オプション] を追加しました。
* Oracle Linux 8 (OEL 8) xref:{page-component-version}@installation:hw-and-sw-requirements.adoc#_certified_operating_systems[認定オペレーティングシステム一覧]に追加しました。
* クエリのインストールプロセスを改善しました。
1つの `INSTALL QUERY` コマンドでクエリのサブセットをインストールする際に失敗しても、すべてのインストールが中断されなくなりました。

=== 可観測性
* TigerGraph のサービス状況を HTTP リクエストで報告する xref:{page-component-version}@tigergraph-server:API:built-in-endpoints.adoc#_show_service_status[エンドポイント `POST /current-service-status`] を追加しました。

=== 信頼性
* GSEにKafkaプロテクションを追加し、大量データロード時のメッセージロスを防止します。

=== セキュリティ
* GSQL logsGSQLのログから AWS S3 のシークレットをマスク処理します。


=== ユーザビリティ - GSQL
* GSQL クエリ言語における xref:3.4@gsql-ref:querying:declaration-and-assignment-statements.adoc#_local_container_variable[ローカルコンテナ変数] のサポートを追加しました。
* GSQLのローカル変数の宣言ルールを緩和しました。
ローカルベース型変数を xref:3.4@gsql-ref:querying:declaration-and-assignment-statements.adoc#_local_base_type_variables[より低いレベルで宣言] して、同じ名前の変数の値を上書きできるようになりました。
* サイズを指定せずに xref:3.4@gsql-ref:querying:accumulators.adoc#_heapaccum[`HeapAccum`] を宣言できるようになりました。
* xref:3.4@gsql-ref:querying:select-statement/sql-like-select-statement.adoc[SQLに似た `SELECT`  文で] `ORDER BY` を使用する際の `LIMIT` 節の必要性が削除されました。
* 分散クエリモードにおける以下の関数の制限を解除しました。
** `edgeAttribute()`
** `neighborAttribute()`
** `neighbor()`
** `size()`
* xref:3.4@gsql-ref:querying:accumulators.adoc#_listaccum[`ListAccum`] と xref:3.4@gsql-ref:querying:accumulators.adoc#_mapaccum[`MapAccum`] に削除機能を追加
** `ListAccum`
*** `.remove()`
*** `.removeOne()`
*** `.removeAll()`
** `MapAccum`
*** `.removeKey()`

=== ユーザビリティ - GraphStudioと管理ポータル
* Visual Query Builder (VQB)において、ビジュアルパターンのマッチング結果を指定したサブセットで出力できる _xref:{page-component-version}@gui:graphstudio:build-graph-patterns/visual-query-builder-overview.adoc#_add_a_pattern_view[Pattern View]_ をサポートしました。
* 頂点やエッジのプライマリ ID が属性としてマークされている場合、その ID を式で使用できるようになりました。
* xref:gui:graphstudio:explore-graph/graph-exploration-panel.adoc[数値属性の書式設定]に対応しました。
* GSQLクエリリストでの検索に対応しました。
* ビジュアルパターンリストでの検索に対応しました。
* ユーザー定義ロールのインターフェイスに、削除ツールチップと全権限を選択するチェックボックスを追加しました。
* スキーマ設計オプションから非推奨の `STRING COMPRESS` データ型を削除しました。

== 改善点

=== 3.4.0の改善点
* Log4j を 2.17.0 にアップグレードし、潜在的なセキュリティ脆弱性を解消しました。
* トランザクションに必要なシステム最小空きメモリの削減
* グラフカタログのダウンロード、更新、削除のタイムアウト制限を強化
* 非特権ユーザーが管理者ポータルを介して GSQL 出力ファイルにアクセスできるバグを修正
* ファイル操作のタイムアウト制限を増加
* サブクエリでファイル変数を使用すると GSE がクラッシュする問題を修正
* SmartContainer がハードウェア情報を複数回収集する問題を修正
* インスタンスが 1000 クエリを超える場合、クラスタの縮小に失敗することがある問題を修正
* Kafka ブローカー ID を確認する際のタイムアウト制限を増加
* 特定のクエリで想定以上のメモリを消費する問題を修正
* まれにRESTPPのメモリリークが発生する問題を修正
* インタプリタが例外を発生させたときにGPEがハングアップすることがある問題を修正
* /gsqlserverエンドポイントに対するプロキシバッファリングを無効にしました。
* Kubernetes のデプロイメントでバックアップとリストアに失敗する問題を修正しました。
* まれに GPE のセグメンテーションフォールトにつながるクエリリクエストのメモリトラッキングの問題を修正しました。
* `getAttr()` に無効な属性が含まれている場合、予期せずクエリーが早期終了することがある問題を修正しました。
* ローカルベース型変数がオーバーライドされると型推論ができなくなる問題を修正
* `PER` 句が予期しない結果を返すことがある問題を修正しました。
* `WHERE` 句で括弧を使用すると、予期しない出力を生成する問題を修正しました。
* `v.outdegree()`  が予期しない結果を返すことがある問題を修正しました。
* アキュムレータの接続関数の呼び出しでエラーが発生する問題を修正しました。
* GraphStudio で巨大なマップデータのカラムを扱うとブラウザがクラッシュする問題を修正
* ライセンス更新後、サービスが自動的に再起動しない問題を修正
* GSQL 構文チェッカーで、SQLに似たクエリが複数の引数を持つ組み込み関数を使用した場合に予期せぬエラーを発生させる問題を修正




== 既知の問題

=== アプリケーション

* *GraphStudio*
 ** xref:gui:graphstudio:known-issues.adoc[GraphStudioの既知の問題]
 ** ノーコードデータ移行機能はアルファ版に用意しております。ご使用の上、フィードバックをいただけましたら幸いです。
 ** ノーコードビジュアルクエリービルダーはベータ版にあります。ご使用の上、フィードバックをいただけましたら幸いです。
* **管理ポータル**
 ** xref:gui:admin-portal:known-issues.adoc[管理ポータルの既知の問題]

=== *GSQL*

* **複数の（連結）パスパターン**
 ** 既知の機能上の問題はありませんが、パフォーマンスは最適化されていません。ご使用の上、フィードバックをいただけましたら幸いです。
* **V2構文でのDMLタイプチェックエラー**
 ** GSQLは、複数のPOST-ACCUM句と属性の削除/更新の操作など、Queryブロックで、誤ったタイプチェックエラーを報告します。
* **3.0.xからアップグレードする際は、GSQL HAを手動でオンにしてください**
 ** 3.0.Xからアップグレードする際は、GSQL HAサービスを手動でスタートさせる必要があります。サポートが必要な場合は、お問い合わせください。プロセスの説明につきましては、以下をご覧ください。 https://tigergraph.freshdesk.com/a/solutions/articles/5000865072
* **index使用時、削除後にも古いデータが表示されます**
 ** セカンダリインデックスを使用するクエリーでは、スナップショットが完全に再構築されるまで、削除された頂点が表示されていることがあります。

== 以前のバージョンのリリースノート
* xref:3.3@tigergraph-server:release-notes:release-notes.adoc[リリースノート - TigerGraph 3.3]
* xref:3.2@tigergraph-server:release-notes:release-notes.adoc[リリースノート - TigerGraph 3.2]

== TigerGraph 3.1との互換性

lTigerGraphのロール・ベースのアクセスコントロール内の、組み込みのロールに以下の変更が加えられました

* 組み込みのロール `queryreader` は、クエリ（データベースの更新を含みます）を実行できなくなりました。
** 古い `queryreader` ロールをエミュレートするには、すべての `queryreader` 権限を持つロールを作成し、そこに `WRITE_DATA` 権限も付与します。
* 組み込みのロール `admin` はユーザーを作成できなくなりました
** 古い `admin` ロールをエミュレートするには、すべての `admin` 権限を持つグローバルロールを作成し、そこに `WRITE_USER` 権限も付与します。
* ロール管理と組み込みロールの権限についての詳細は、以下をご覧ください。
** xref:user-access:role-management.adoc[ロール管理]
** xref:reference:list-of-privileges.adoc[権限]

== TigerGraph 2との互換性

大規模な改訂(TigerGraph 2からTigerGraph 3への改訂など)の際は、大幅な改善を行っています。当社では下位互換性を維持するために最大限の注意を払っていますが、製品の品質向上のため、APIの変更や、廃止された機能の削除が行われていることがあります。

**データの移行**: TigerGraph 2.6のデータをTigerGraph 3.0に移行するツールをご利用いただけます。サポートにつきましては、TigerGraphサポートにお問い合わせください。

**クエリーとAPIの互換性**:

* 一部のgadmin構文が変更されました。特に `gadmin setconfig` は `gadmin configset` に変更されていますのでご注意ください。詳細はxref:gadmin:management-with-gadmin.adoc[gadminによる管理]を参照してください。
* 以前に廃止された機能の一部は削除されました。詳細なリストについては、xref:release-notes:v3.0-removal-of-previously-deprecated-features.adoc[V3.0以前に廃止された機能の削除]をご確認ください。

include::v3.0-removal-of-previously-deprecated-features.adoc[]